# Goodnight 宵禁

- 作者: Jonesn、羽学
- 出处: 无
- 本插件整合了白名单、宵禁、禁止召唤怪物等插件功能
- 每天指定时间禁止进服或禁止召唤怪物（满足在线人数自动解禁召唤怪物）
- 在规定时间内根据在线人数来判断是否允许召唤未击败的怪物
- 如果超过宵禁时间则不做任何处理，通过NPC死亡事件判断取值【禁止怪物表】里的ID到【允许召唤怪物表】
- 方便下次宵禁时间判断哪些怪物允许在宵禁时间内召唤，避免单人推服务器进度的情况。

## 更新日志

```
v2.4.0
加入了根据击杀《禁止怪物生成表》计数，
写入《允许召唤怪物表》与其相关指令
计数要求则在满足在线人数或不在宵禁时间段
由玩家主动击杀存在《禁止怪物生成表》的怪物自动计入（无需手写）
加个配置项与指令，控制击杀什么怪物ID来重置《允许召唤怪物表》

v2.3.0
加入宵禁时间内可召唤已击败怪物
通过监听怪物死亡事件从禁止怪物表中
取值后比对赋值给“已击败进度限制”配置项实现
击败月总后自动清空“已击败进度限制”配置项

v2.2.1
修复移除内置配置项的“集合型”参数引起的指令覆盖参数问题
修复重启服务器覆盖配置参数的问题

v2.2.0
彻底修复Reload覆盖写入怪物ID问题
给弹幕更新方法补充了权限检查
加入了/gn 指令方法控制配置项

v2.1.1
清除无用代码，给断开玩家连接加入全检查

v2.1.0
修复玩家加入服务器拦截方法
加入在线人数判断禁止召唤怪物
将配置项加以描述，并把禁怪物表整理为全进度BOSS的NpcID
修复每次/Reload都会写入一次内置怪物ID问题

v2.0.0
加入了禁止召唤怪物逻辑
羽学适配了.net6.0并重构了大部分方法
```

## 指令

| 语法                             | 别名  |       权限       |                   说明                   |
| -------------------------------- | :---: | :--------------: | :--------------------------------------: |
| /gn |  /宵禁  |  goodnight.admin |    查看宵禁指令菜单    |
| /gn on | 无 |  goodnight.admin |    开启或关闭宵禁功能    |
| /gn kick | 无 |  goodnight.admin |    开启或关闭断连功能    |
| /gn time start & stop 23:59:59 | /gn time set & end |  goodnight.admin |    设置宵禁开启结束时间    |
| /gn list | 无 |  goodnight.admin |    列出《禁止怪物生成表》    |
| /gn add 怪名 或 id| 无 |  goodnight.admin |    添加《禁止怪物生成表》的指定怪物    |
| /gn del 怪名 或 id| 无 |  goodnight.admin |    删除《禁止怪物生成表》的指定怪物    |
| /gn boss 次数 | 无 |  goodnight.admin |    设置加入《允许召唤怪物表》击杀要求次数    |
| /gn reset 怪物ID | 无 |  goodnight.admin |    设置重置《允许召唤怪物表》的怪物ID    |
| /gn plr 人数 | 无 |  goodnight.admin |    设置宵禁时段无视《禁止怪物生成表》在线人数    |
| /gn plr add 玩家名 | 无 |  goodnight.admin |    添加指定玩家到断连豁免名单    |
| /gn plr del 玩家名 | 无 |  goodnight.admin |    把指定玩家从断连豁免名单移除    |
| /reload |  无  |  tshock.cfg.reload |    重载配置文件    |





## 配置

```json
{
  "是否关闭宵禁": true,
  "宵禁是否断连": false,
  "玩家进服拦截消息": "当前为宵禁时间，无法加入游戏。",
  "踢出玩家断连消息": "到点了，晚安",
  "断连豁免玩家": [
    "羽学"
  ],
  "禁怪少于人数(设1为关闭禁怪)": 2,
  "宵禁时间设置(禁怪/断连)": {
    "Start": "00:00:00",
    "Stop": "06:59:59"
  },
  "击杀多少次开始记录进度": 3,
  "击败什么重置允许召唤怪物表": 398,
  "允许召唤怪物表(自动计数)": [],
  "禁止怪物生成表(NpcID)": [
    4,
    13,
    14,
    15,
    35,
    36,
    37,
    50,
    113,
    114,
    125,
    126,
    127,
    128,
    129,
    130,
    131,
    134,
    135,
    136,
    222,
    245,
    246,
    247,
    248,
    249,
    262,
    266,
    370,
    396,
    397,
    398,
    400,
    439,
    440,
    422,
    493,
    507,
    517,
    636,
    657,
    668
  ]
}
```
## 反馈
- 共同维护的插件库：https://github.com/Controllerdestiny/TShockPlugin
- 国内社区trhub.cn 或 TShock官方群等